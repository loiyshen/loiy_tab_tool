# 芦艺标签页分组工具 - 产品需求文档 (PRD)

**版本**: 1.1

---

## 1. 项目概述

**芦艺标签页分组工具** 是一款 Chrome 浏览器插件，它将传统的插件弹窗（Popup）体验升级为常驻的侧边栏（Side Panel），旨在帮助用户自动化管理和组织日益增多的浏览器标签页。通过让用户在侧边栏中便捷地自定义规则，插件能够智能、自动地将来自同一域名或相关域名的标签页聚合到指定的分组中，从而显著提升浏览效率和工作区的整洁度。

## 2. 目标用户

本项目主要服务于以下类型的用户：
- 研究人员和学生: 需要同时打开大量来自不同来源（如学术网站、新闻门户、论坛）的标签页。
- 开发者和设计师: 工作中常需要在多个文档、API 参考和项目管理工具之间频繁切换。
- 信息工作者: 日常工作依赖浏览器进行大量信息检索和处理，标签页容易变得混乱。
- 所有追求高效率和有序浏览体验的用户。

## 3. 核心功能

### 3.1. 自定义分组规则
用户可以通过插件侧边栏界面方便地配置分组规则。一条完整的规则包括三个要素：
- 域名 (Domain): 用于匹配标签页 URL 的关键字。匹配逻辑为包含匹配，例如规则 `google.com` 可以匹配 `mail.google.com` 和 `docs.google.com`。
- 分组名称 (Group Name): 自动创建的标签页分组的显示名称。
- 分组颜色 (Group Color): 用户可以通过下拉框选择预设的颜色选项。该颜色会直观地体现在规则列表项的背景上。

### 3.2. 全自动后台分组
插件的核心价值在于其“即时自动”分组能力。
- 触发时机: 当任何标签页加载完成时，插件会立即触发分组逻辑。
- 匹配机制: 自动获取当前标签页的域名，并与用户保存的规则进行匹配。
- 智能分组:
    - 如果存在匹配规则，且该窗口内已存在同名分组，则直接将该标签页加入现有分组。
    - 如果存在匹配规则，但窗口内尚无同名分组，则插件会自动创建一个新分组，并设置好名称和最接近的用户自定义颜色，然后将标签页移入其中。
    - 如果没有匹配的规则，则标签页保持原样，不进行任何操作。

### 3.3. 配置的持久化与管理
- 保存与加载: 用户的分组规则配置会通过 `chrome.storage.sync` API 保存，这意味着配置可以在用户登录了同一 Google 账户的多个设备间同步。
- 添加、编辑与删除: 用户可以随时在侧边栏中添加新规则、编辑现有规则或删除不再需要的规则，所有的操作即时生效，并写入存储。

## 4. 功能详述

### 4.1. 侧边栏界面 (side_panel.html)
这是用户与插件交互的主要窗口，固定在浏览器右侧，提供了宽敞且持久的操作空间。
- 交互模式: 通过单击浏览器工具栏上的插件图标，可以轻松打开和关闭侧边栏。
- 规则输入区:
    - 提供了域名、分组名称的输入框和颜色下拉框。
    - 包含“添加”、“更新”、“取消”按钮，并根据当前是新建还是编辑状态智能显示/隐藏。
- 规则列表区:
    - 实时显示所有规则。列表区域高度自适应，内容超长时可滚动。
    - 每个规则项的背景色会直接使用用户选择的颜色，文字颜色为 #333333，以保证可读性。
    - 每条规则后都配有“编辑”和“删除”按钮。点击“编辑”会将该规则数据加载到输入区，并进入编辑模式。

### 4.2. 后台服务脚本 (background.js)
这是实现自动化的核心，在后台静默运行，用户无感知。
- 事件监听: 持续监听 `chrome.tabs.onUpdated` 事件，只在标签页状态为 `complete` (加载完成) 时执行。
- 逻辑流程:
    1. 获取触发事件的标签页 URL，并解析出其主机名（域名）。
    2. 从 `chrome.storage.sync` 异步获取用户保存的所有分组规则。
    3. 遍历规则，查找第一个与当前域名匹配的规则。
    4. 如果找到匹配项，则查询当前浏览器窗口内是否已存在目标分组。
    5. 根据查询结果，执行加入或创建分组的操作。创建新分组时，根据用户选择的预设颜色设置分组颜色。

## 5. 技术栈
- 前端: HTML, CSS, JavaScript
- 浏览器 API:
    - chrome.storage: 用于持久化存储用户的自定义规则。
    - chrome.tabs: 用于监听标签页事件和获取标签页信息。
    - chrome.tabGroups: 用于创建、查询和管理标签页分组。
    - chrome.sidePanel: 用于实现侧边栏交互。
- 清单版本: Manifest V3